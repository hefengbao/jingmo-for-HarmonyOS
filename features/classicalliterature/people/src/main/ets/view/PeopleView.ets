import { BoldTitle, ContentText } from 'uicomponents';
import { Alias, Detail, Hometown, People } from '../model/People';

@ComponentV2
export struct PeopleView {
  @Param @Require people: People;

  build() {
    Column() {
      ContentText({ text: this.people.Name })
      BoldTitle({ text: 'ç”Ÿå’å¹´æœˆ' })
      ContentText({ text: parseBirthDeath(this.people) })
      BoldTitle({ text: 'ä¸»è¦ç”Ÿæ´»æœä»£' })
      ContentText({ text: this.people.Dynasty })
      if (this.people.Aliases) {
        BoldTitle({ text: 'åˆ«ç§°' })
        ContentText({ text: parseAliases(this.people.Aliases) })
      }
      if (this.people.Titles) {
        BoldTitle({ text: 'æ ‡ç­¾' })
        ContentText({ text: this.people.Titles.join('ã€') })
      }
      if (this.people.Hometown) {
        BoldTitle({ text: 'å®¶ä¹¡' })
        ContentText({
          text: this.people.Hometown.map((hometown: Hometown) => {
            return hometown.Name
          }).join('ã€')
        })
      }
      if (this.people.Details) {
        BoldTitle({ text: 'äººç‰©èµ„æ–™' })
        ForEach(this.people.Details, (detail: Detail) => {
          ContentText({ text: `ğŸ“– ${detail.Book}` })
          if (detail.Content) {
            ContentText({
              text: detail.Content.replace("<br />", "\n")
                .replace("</p>", "\n")
                .replace(new RegExp("<[^>]+>"), "")
            })
          }
        })
      }
    }
    .width('100%')
    .align(Alignment.TopStart)
  }
}

function parseBirthDeath(people: People): string {
  let str = '';

  if (people.BirthYear) {
    if (Number(people.BirthYear) < 0) {
      str += `å…¬å…ƒå‰${Math.abs(Number(people.BirthYear))}å¹´`
    } else {
      str += `å…¬å…ƒ${people.BirthYear}å¹´`
    }
    if (people.BirthDay) {
      if (people.BirthDay.search('æœˆ')) {
        str += people.BirthDay;
      } else {
        let arr = people.BirthDay.split("/")
        if (arr.length == 2) {
          str += `${arr[0]}æœˆ${arr[1]}æ—¥`
        }
      }
    }
  } else {
    str += '?'
  }

  str += ' - '

  if (people.DeathYear) {
    if (Number(people.DeathYear) < 0) {
      str += `å…¬å…ƒå‰${Math.abs(Number(people.DeathYear))}å¹´`
    } else {
      str += `å…¬å…ƒ${people.DeathYear}å¹´`
    }
    if (people.DeathDay) {
      if (people.DeathDay.search('æœˆ')) {
        str += people.DeathDay;
      } else {
        let arr = people.DeathDay.split("/")
        if (arr.length == 2) {
          str += `${arr[0]}æœˆ${arr[1]}æ—¥`
        }
      }
    }
  } else {
    str += '?'
  }

  return str;
}

function parseAliases(aliases: Alias[]): string {
  return aliases.map((alias: Alias) => {
    let type = 'å…¶ä»–';
    switch (alias.Type) {
      case "BieCheng":
        type = "åˆ«ç§°"
        break;
      case "Xing":
        type = "å§“";
        break;
      case "Zi":
        type = "å­—";
        break;
      case "Hao":
        type = "å·";
        break;
      case "Ming":
        type = "å";
        break;
      case "ShiHao":
        type = "è°¥å·";
        break;
      case "FengJue":
        type = "å°å·";
        break;
      case "FamousName":
        type = "ä¸–ç§°";
        break;
      case "PreUsedName":
        type = "æ›¾ç”¨å";
        break;
      case "XingMing":
        type = "å§“å";
        break;
    }

    return `${type}ï¼š${alias.Name}`
  }).join(' ')
}